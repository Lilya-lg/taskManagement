<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Create Task</title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h2>Menu</h2>
    <ul>
      <li><a href="/dashboard">Dashboard</a></li>
      <li><a href="/tasks">Tasks</a></li>
      <li><a href="/change-requests">Change Requests</a></li>
      <li><a href="/users">Users</a></li>
      <li><a href="/profile">Profile</a></li>
    </ul>
  </div>

  <div class="main-content">
    <header>
      <h1>Create New Task</h1>
    </header>

    <!-- Task form container -->
    <div class="form-container">
      <form th:action="@{/tasks/new}" method="post" th:object="${task}">
        <!-- Task Title -->
        <div class="form-row">
          <label for="title">Title:</label>
          <input type="text" id="title" th:field="*{title}" />
          <span th:if="${#fields.hasErrors('title')}" th:errors="*{title}">Error</span>
        </div>

        <!-- Task Description -->
        <div class="form-row">
          <label for="description">Description:</label>
          <textarea id="description" th:field="*{description}" rows="4"></textarea>
          <span th:if="${#fields.hasErrors('description')}" th:errors="*{description}">Error</span>
        </div>

        <!-- Task Status -->
        <div class="form-row">
          <label for="status">Status:</label>
          <select id="status" th:field="*{status}">
            <option value="TODO">TODO</option>
            <option value="IN_PROGRESS">In Progress</option>
            <option value="COMPLETED">Completed</option>
          </select>
          <span th:if="${#fields.hasErrors('status')}" th:errors="*{status}">Error</span>
        </div>

        <!-- Task Due Date -->
        <div class="form-row">
          <label for="dueDate">Due Date:</label>
          <input type="date" id="dueDate" th:field="*{dueDate}" />
          <span th:if="${#fields.hasErrors('dueDate')}" th:errors="*{dueDate}">Error</span>
        </div>
        <div class="form-row">
          <label for="requestType">Request Type:</label>
          <select id="requestType" th:field="*{requestType}">
            <option value="INFRA">INFRA</option>
            <option value="PROD_APPS">Prod Apps</option>
            <option value="BUSINESS_APPS">Business Apps</option>
          </select>
        </div>
        <!-- Assigned User -->
        <div class="form-row">
          <label for="assignedUser">Assigned User:</label>
          <select id="assignedUser" th:field="*{assignedUser.id}">
            <!-- Default option for no user assigned -->
            <option value="" th:if="${assignedUser == null}">No User Assigned</option>
            <!-- Iterate over the users list and populate the dropdown -->
            <option th:each="user : ${users}" th:value="${user.id}"
                    th:text="${user.firstName + ' ' + user.lastName}"
                    th:selected="${assignedUser != null and user.id == assignedUser.id}">User</option>
          </select>
          <span th:if="${#fields.hasErrors('assignedUser')}" th:errors="*{assignedUser}">Error</span>
        </div>

        <!-- Requester (Read-Only) -->
        <div class="form-row">
          <label for="requester">Requester:</label>
          <input type="text" id="requester"
                 th:field="*{requester.firstName}"
                 th:value="${requester != null ? requester.firstName : ''}"
                 placeholder="Requester First Name" />
          <span th:if="${#fields.hasErrors('requester')}" th:errors="*{requester}">Error</span>
        </div>


        <!-- Submit button -->
        <div class="form-row">
          <button type="submit">Create Task</button>
        </div>
      </form>
    </div>
  </div>
</div>
</body>
</html>
